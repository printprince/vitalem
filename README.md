# Vitalem Microservices

Микросервисная архитектура для медицинской платформы Vitalem.

## Обзор проекта

Vitalem - это медицинская платформа, построенная на микросервисной архитектуре. Проект разделен на независимые сервисы, каждый из которых отвечает за свою область функциональности.

### Сервисы

- **Gateway Service** (:8800) - Единая точка входа для всех API
- **Identity Service** (:8801) - Аутентификация и авторизация пользователей
- **Patient Service** (:8804) - Управление профилями пациентов
- **Specialist Service** (:8803) - Управление профилями врачей
- **Appointment Service** (:8805) - Управление расписанием и записями
- **Notification Service** (:8806) - Отправка уведомлений
- **FileServer Service** (:8087) - Управление файлами
- **Logger Service** (:8802) - Централизованное логирование для всех микросервисов

### Общие компоненты

- **Utils Package** - Общие middleware для всех сервисов:
  - JWT аутентификация
  - CORS настройки
  - Валидация запросов

## Архитектура

Проект построен на микросервисной архитектуре с использованием следующих принципов:

- **Независимость сервисов** - Каждый сервис может быть разработан, развернут и масштабирован независимо
- **Общие компоненты** - Middleware (JWT, CORS, валидация) вынесены в shared package для переиспользования
- **Единая точка логирования** - Все сервисы отправляют логи в централизованный Logger Service
- **Контейнеризация** - Все сервисы запускаются в Docker-контейнерах
- **Интеграция с ELK** - Для анализа и визуализации логов используется стек Elasticsearch, Kibana, Filebeat

### Взаимодействие между сервисами

```
                    ┌─────────────────┐
                    │   Клиенты       │
                    │   (Frontend)    │
                    └─────────────────┘
                             │ HTTP (REST API)
                             ▼
    ┌─────────────────────────────────────────────────────────────┐
    │                API Gateway Layer                            │
    │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
    │  │  Identity   │  │   Patient   │  │    Specialist       │  │
    │  │  Service    │  │   Service   │  │    Service          │  │
    │  │  :8801      │  │   :8804     │  │    :8803            │  │
    │  └─────────────┘  └─────────────┘  └─────────────────────┘  │
    └─────────────────────────────────────────────────────────────┘
             │                │                      │
             │ Events         │ Events               │ Events
             ▼                ▼                      ▼
    ┌─────────────────────────────────────────────────────────────┐
    │                   RabbitMQ                                  │
    │            (Event-Driven Communication)                     │
    └─────────────────────────────────────────────────────────────┘
                             │
                             │ Logs (HTTP)
                             ▼
                    ┌─────────────────┐
                    │  Logger Service │
                    │     :8802       │
                    └─────────────────┘
                             │
                             │ Index Logs
                             ▼
    ┌─────────────────────────────────────────────────────────────┐
    │                  Data Layer                                 │
    │  ┌─────────────┐              ┌─────────────────────────┐    │
    │  │ PostgreSQL  │              │    Elasticsearch       │    │
    │  │   :5433     │              │       :9200             │    │
    │  │(User Data)  │              │   (Logs Storage)        │    │
    │  └─────────────┘              └─────────────────────────┘    │
    └─────────────────────────────────────────────────────────────┘
                                             │
                                             │ Visualization
                                             ▼
                                    ┌─────────────────┐
                                    │     Kibana      │
                                    │     :5601       │
                                    │  (Log Analysis) │
                                    └─────────────────┘
```

**Потоки данных:**
- **HTTP API** - Клиенты взаимодействуют с сервисами через REST API
- **JWT Auth** - Все сервисы используют общий JWT middleware для аутентификации  
- **Events** - Сервисы обмениваются событиями через RabbitMQ (создание пользователей, профилей)
- **Logging** - Все сервисы отправляют логи в Logger Service для централизованного хранения
- **Database** - Общая PostgreSQL база для всех пользовательских данных
- **Analytics** - Логи индексируются в Elasticsearch и визуализируются в Kibana

## Технологический стек

- **Языки программирования**: Go
- **Фреймворки**: Echo (REST API)
- **Базы данных**: PostgreSQL
- **Брокер сообщений**: RabbitMQ (событийная архитектура)
- **Логирование**: ELK Stack (Elasticsearch, Kibana, Filebeat)
- **Контейнеризация**: Docker, Docker Compose
- **Общие компоненты**: JWT, CORS, Validator middleware

## Система логирования

Проект использует централизованную систему логирования на базе ELK-стека (Elasticsearch, Kibana, Filebeat) и собственного Logger Service. Логи всех сервисов отправляются в единое хранилище и доступны для просмотра через Kibana.

Подробная информация о настройке и использовании системы логирования доступна в [документации Logger Service](./logger_service/README.md).

## Документация API

Проект включает полную Swagger/OpenAPI документацию для Gateway Service, которая охватывает все доступные эндпоинты системы.

### Доступ к Swagger UI

После запуска системы Swagger UI будет доступен по адресу:
- **http://localhost:8808** - Интерактивная документация API

Swagger UI предоставляет:
- Полное описание всех API эндпоинтов
- Интерактивное тестирование API
- Схемы данных и примеры запросов/ответов
- Информацию об аутентификации и авторизации

### Использование API

- **Базовый URL**: `http://localhost:8800` (Gateway Service)
- **Аутентификация**: JWT Bearer Token
- **Формат данных**: JSON

Подробная документация по каждому сервису доступна в Swagger UI или в соответствующих файлах README.md.

## Запуск проекта

### Предварительные требования

- Docker и Docker Compose
- Go 1.21+

### Запуск с помощью Docker Compose

```bash
docker-compose up -d
```

Это запустит все сервисы, включая:
- Все микросервисы (Gateway, Identity, Patient, Specialist, и др.)
- Базы данных (PostgreSQL, Elasticsearch)
- Инфраструктурные сервисы (RabbitMQ, MinIO, Kibana)
- Swagger UI для документации API

### Доступные порты после запуска

- **8800** - Gateway Service (основной API)
- **8808** - Swagger UI (документация)
- **5601** - Kibana (анализ логов)
- **15672** - RabbitMQ Management UI
- **9001** - MinIO Console

## Разработка

Каждый сервис содержит свою собственную документацию в соответствующем README.md файле с подробными инструкциями по разработке и использованию.

### Middleware рефакторинг

Для устранения дублирования кода все middleware компоненты были вынесены в общий `utils` пакет:

- **JWT Middleware** - Единая аутентификация для всех сервисов
- **CORS Middleware** - Стандартные настройки CORS
- **Validator Middleware** - Валидация входящих запросов

Все сервисы используют общие middleware через зависимость `../utils`, что обеспечивает:
- Единообразие настроек безопасности
- Простоту обновления middleware логики
- Уменьшение дублирования кода

## Лицензия

Vitalem

